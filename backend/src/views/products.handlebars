<div class="container">
  <h1>Productos - CALIGO</h1>
  
  <div class="products-grid">
    {{#each products}}
      <div class="product-card">
        <h3>{{this.title}}</h3>
        <p>{{this.description}}</p>
        <p class="price">${{this.price}}</p>
        <p>Categoría: {{this.category}}</p>
        <p>Stock: {{this.stock}}</p>
        <div class="product-actions">
          <a href="/products/{{this._id}}" class="btn btn-detail">Ver Detalle</a>
          <button class="btn btn-cart" data-product-id="{{this._id}}">Agregar al Carrito</button>
        </div>
      </div>
    {{/each}}
  </div>

  <div class="pagination">
    {{#if hasPrevPage}}
      <a href="{{prevLink}}" class="btn">← Anterior</a>
    {{/if}}
    <span>Página {{page}} de {{totalPages}}</span>
    {{#if hasNextPage}}
      <a href="{{nextLink}}" class="btn">Siguiente →</a>
    {{/if}}
  </div>
</div>

<script>
  document.querySelectorAll('.btn-cart').forEach(button => {
    button.addEventListener('click', async function() {
      const productId = this.getAttribute('data-product-id');
      await addToCart(productId);
    });
  });

  async function addToCart(productId) {
    try {
      let cartId = localStorage.getItem('cartId');
      
      if (!cartId) {
        const response = await fetch('/api/carts', {
          method: 'POST'
        });
        const data = await response.json();
        cartId = data.payload._id;
        localStorage.setItem('cartId', cartId);
      }
      
      const response = await fetch(`/api/carts/${cartId}/product/${productId}`, {
        method: 'POST'
      });
      
      if (response.ok) {
        alert('Producto agregado al carrito');
      } else {
        const error = await response.json();
        alert('Error: ' + error.message);
      }
    } catch (error) {
      console.error('Error:', error);
      alert('Error al agregar al carrito');
    }
  }
</script>

<style>
  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
  }
  
  .products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    margin: 20px 0;
  }
  
  .product-card {
    border: 1px solid #ddd;
    padding: 15px;
    border-radius: 8px;
    background: white;
  }
  
  .product-card h3 {
    margin-top: 0;
  }
  
  .price {
    font-size: 1.5em;
    color: #2ecc71;
    font-weight: bold;
  }
  
  .product-actions {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 10px;
  }
  
  .btn {
    padding: 10px;
    text-decoration: none;
    text-align: center;
    border-radius: 5px;
    cursor: pointer;
    border: none;
  }
  
  .btn-detail {
    background-color: #3498db;
    color: white;
  }
  
  .btn-cart {
    background-color: #2ecc71;
    color: white;
  }
  
  .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-top: 30px;
  }
  
  .pagination .btn {
    background-color: #34495e;
    color: white;
  }
</style>